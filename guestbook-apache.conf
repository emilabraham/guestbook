# HTTP — certbot will add the HTTPS block and redirect automatically
<VirtualHost *:80>
    ServerName guestbook.emilabraham.com

    # Frontend — static files
    DocumentRoot /var/www/guestbook

    # API routes — proxy to guestbook backend
    ProxyPreserveHost On
    ProxyPass        /submit http://127.0.0.1:8766/submit
    ProxyPassReverse /submit http://127.0.0.1:8766/submit
    ProxyPass        /gallery http://127.0.0.1:8766/gallery
    ProxyPassReverse /gallery http://127.0.0.1:8766/gallery

    # Forward real client IP to the API (for rate limiting)
    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s

    ErrorLog  ${APACHE_LOG_DIR}/guestbook-error.log
    CustomLog ${APACHE_LOG_DIR}/guestbook-access.log combined
</VirtualHost>
